"use strict";var calendarHeatmap={settings:{gutter:5,item_gutter:1,width:1e3,height:200,item_size:30,label_padding:40,max_block_height:20,transition_duration:500,tooltip_width:250,tooltip_padding:15},init:function(a,e,t,n,r){moment.updateLocale("en",{week:{dow:1}}),calendarHeatmap.data=calendarHeatmap.parseServerData(a),calendarHeatmap.container=e,calendarHeatmap.objColorConfig=t||"#ff4500",calendarHeatmap.overview=n||"global",calendarHeatmap.history=["global"],calendarHeatmap.selected={},calendarHeatmap.currDate=moment(),calendarHeatmap.handler=r,calendarHeatmap.in_transition=!1,calendarHeatmap.createElements(),calendarHeatmap.parseData(),calendarHeatmap.drawChart()},createElements:function(){if(null!=calendarHeatmap.container){if(!(a=document.getElementById(calendarHeatmap.container))||"DIV"!=a.tagName)throw"Element not found or not of type div";a.classList.contains("calendar-heatmap")||a.classList.add("calendar-heatmap")}else{var a;(a=document.createElement("div")).className="calendar-heatmap",document.body.appendChild(a)}var e=d3.select(a).append("svg").attr("class","svg");calendarHeatmap.items=e.append("g"),calendarHeatmap.labels=e.append("g"),calendarHeatmap.buttons=e.append("g"),calendarHeatmap.tooltip=d3.select(a).append("div").attr("class","heatmap-tooltip").style("opacity",0);var t=function(){var t=Math.round((moment()-moment().subtract(1,"year").startOf("week"))/864e5),n=Math.trunc(t/7)+1;calendarHeatmap.settings.width=a.offsetWidth<1200?1200:a.offsetWidth,calendarHeatmap.settings.item_size=(calendarHeatmap.settings.width-calendarHeatmap.settings.label_padding)/n-calendarHeatmap.settings.gutter<20?25:(calendarHeatmap.settings.width-calendarHeatmap.settings.label_padding)/n-calendarHeatmap.settings.gutter,calendarHeatmap.settings.height=calendarHeatmap.settings.label_padding+7*(calendarHeatmap.settings.item_size+calendarHeatmap.settings.gutter),e.attr("width",calendarHeatmap.settings.width).attr("height",calendarHeatmap.settings.height),calendarHeatmap.data&&calendarHeatmap.data[0].summary&&calendarHeatmap.drawChart()};t(),window.onresize=function(a){t()}},parseData:function(){calendarHeatmap.data&&(calendarHeatmap.data[0].summary||calendarHeatmap.data.map((function(a){var e=a.details.reduce((function(a,e){return a[e.name]?(a[e.name].value+=e.value,a[e.name].type=e.type):a[e.name]={value:e.value,type:e.type},a}),{}),t=Object.keys(e).map((function(a){return{name:a,value:e[a].value,type:e[a].type}}));return a.summary=t.sort((function(a,e){return e.value-a.value})),a})))},parseServerData:function(a){var e={};for(var t of a){var n=t[1].match(/T/)?t[1].replaceAll(/T(\d+:)*\d+\+/gi,"T00:00:00+"):t[1].replaceAll(/\s(\d+:)*\d+/gi,"T00:00:00");e[n]||(e[n]=[]),e[n].push(t)}var r=[];for(var l in e){var i,o=[],d=0,s=null;e[l].forEach((function(a,e){o.push({date:a[1],name:a[2],value:a[4],strProjects:a[0],type:a[6]}),s=a[0].match(/Public/)||a[0].match(/Sick/)||a[0].match(/Annual/)?a[0]:s,d+=a[4]})),i=o[0].strProjects.substring(o[0].strProjects.indexOf("|")+1,o[0].strProjects.indexOf(":")),o.sort((function(a,e){return a.type>e.type})),r.push({date:l,details:o,total:d,strProjects:1==o.length?o[0].strProjects:s,strToolTip:1==o.length?i:null,type:o[0].type})}return r.sort((function(a,e){return moment(a.date)-moment(e.date)})),r},drawChart:function(){"global"===calendarHeatmap.overview?calendarHeatmap.drawGlobalOverview():"year"===calendarHeatmap.overview?calendarHeatmap.drawYearOverview():"month"===calendarHeatmap.overview?calendarHeatmap.drawMonthOverview():"week"===calendarHeatmap.overview?calendarHeatmap.drawWeekOverview():"day"===calendarHeatmap.overview&&calendarHeatmap.drawDayOverview()},drawGlobalOverview:function(){calendarHeatmap.history[calendarHeatmap.history.length-1]!==calendarHeatmap.overview&&calendarHeatmap.history.push(calendarHeatmap.overview);var a=moment(calendarHeatmap.data[0].date).startOf("year"),e=moment(calendarHeatmap.data[calendarHeatmap.data.length-1].date).endOf("year"),t=d3.timeYears(a,e).map((function(a){var e,t=moment(a);return{date:t,total:calendarHeatmap.data.reduce((function(a,e){return moment(e.date).year()===t.year()&&(a+=e.total),a}),0),summary:(e=calendarHeatmap.data.reduce((function(a,e){if(moment(e.date).year()===t.year())for(var n=0;n<e.summary.length;n++)a[e.summary[n].name]?a[e.summary[n].name].value+=e.summary[n].value:a[e.summary[n].name]={value:e.summary[n].value};return a}),{}),Object.keys(e).map((function(a){return{name:a,value:e[a].value}})).sort((function(a,e){return e.value-a.value})))}})),n=d3.max(t,(function(a){return a.total}));calendarHeatmap.items.selectAll(".item-block-month").remove(),calendarHeatmap.items.selectAll(".text").remove(),calendarHeatmap.items.selectAll(".item-rect").remove(),calendarHeatmap.items.selectAll(".item-rect").remove(),calendarHeatmap.labels.selectAll(".label-monthDate").remove();var r=d3.timeYears(a,e).map((function(a){return moment(a)})),l=d3.scaleBand().rangeRound([0,calendarHeatmap.settings.width]).padding([.05]).domain(r.map((function(a){return a.year()})));calendarHeatmap.items.selectAll(".item-block-year").remove();calendarHeatmap.items.selectAll(".item-block-year").data(t).enter().append("rect").attr("class","item item-block-year").attr("width",(function(){return(calendarHeatmap.settings.width-calendarHeatmap.settings.label_padding)/r.length-5*calendarHeatmap.settings.gutter})).attr("height",(function(){return calendarHeatmap.settings.height-calendarHeatmap.settings.label_padding})).attr("transform",(function(a){return"translate("+l(a.date.year())+","+2*calendarHeatmap.settings.tooltip_padding+")"})).attr("stroke","#292929").attr("fill",(function(a){return d3.scaleLinear().range(["#fff6ed",calendarHeatmap.color||"#fff6ed"]).domain([-.15*n,n])(a.total)||"#fff6ed"})).on("click",(function(a){calendarHeatmap.in_transition||(calendarHeatmap.in_transition=!0,calendarHeatmap.selected=a,calendarHeatmap.hideTooltip(),calendarHeatmap.removeGlobalOverview(),calendarHeatmap.overview="year",calendarHeatmap.drawChart())})).style("opacity",0).on("mouseover",(function(a){if(!calendarHeatmap.in_transition){var e="";e+="<div><span><strong>Total time booked:</strong></span>";var t=parseInt(a.total,10),n=Math.floor(t/28800);n>0&&(e+="<span>"+(1===n?"1 day":n+" days")+"</span></div>");var r=Math.floor((t-28800*n)/3600);r>0&&(e+=n>0?"<div><span></span><span>"+(1===r?"1 hour":r+" hours")+"</span></div>":"<span>"+(1===r?"1 hour":r+" hours")+"</span></div>");var i=Math.floor((t-28800*n-3600*r)/60);if(i>0&&(e+=n>0||r>0?"<div><span></span><span>"+(1===i?"1 minute":i+" minutes")+"</span></div>":"<span>"+(1===i?"1 minute":i+" minutes")+"</span></div>"),e+="<br />",a.summary.length<=5)for(var o=0;o<a.summary.length;o++)e+="<div><span><strong>"+a.summary[o].name+"</strong></span>",e+="<span>"+calendarHeatmap.formatTime(a.summary[o].value)+"</span></div>";else{for(o=0;o<5;o++)e+="<div><span><strong>"+a.summary[o].name+"</strong></span>",e+="<span>"+calendarHeatmap.formatTime(a.summary[o].value)+"</span></div>";e+="<br />";var d=0;for(o=5;o<a.summary.length;o++)d=+a.summary[o].value;e+="<div><span><strong>Other:</strong></span>",e+="<span>"+calendarHeatmap.formatTime(d)+"</span></div>"}for(var s=l(a.date.year())+2*calendarHeatmap.settings.tooltip_padding;calendarHeatmap.settings.width-s<calendarHeatmap.settings.tooltip_width+5*calendarHeatmap.settings.tooltip_padding;)s-=10;var m=Math.abs(document.getElementById(calendarHeatmap.container).getBoundingClientRect().top-document.getElementById(calendarHeatmap.container).getBoundingClientRect().height)+calendarHeatmap.settings.tooltip_padding;calendarHeatmap.tooltip.html(e).style("left",s+"px").style("top",m+"px").transition().duration(calendarHeatmap.settings.transition_duration/2).ease(d3.easeLinear).style("opacity",1)}})).on("mouseout",(function(){calendarHeatmap.in_transition||calendarHeatmap.hideTooltip()})).transition().delay((function(a,e){return calendarHeatmap.settings.transition_duration*(e+1)/10})).duration((function(){return calendarHeatmap.settings.transition_duration})).ease(d3.easeLinear).style("opacity",1).call((function(a,e){a.empty()&&e();var t=0;a.each((function(){++t})).on("end",(function(){--t||e.apply(this,arguments)}))}),(function(){calendarHeatmap.in_transition=!1}));calendarHeatmap.labels.selectAll(".label-year").remove(),calendarHeatmap.labels.selectAll(".label-year").data(r).enter().append("text").attr("class","label label-year").attr("font-size",(function(){return Math.floor(calendarHeatmap.settings.label_padding/3)+"px"})).text((function(a){return a.year()})).attr("x",(function(a){return l(a.year())})).attr("y",calendarHeatmap.settings.label_padding/2).on("mouseenter",(function(a){calendarHeatmap.in_transition||calendarHeatmap.items.selectAll(".item-block-year").transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style("opacity",(function(e){return moment(e.date).year()===a.year()?1:.1}))})).on("mouseout",(function(){calendarHeatmap.in_transition||calendarHeatmap.items.selectAll(".item-block-year").transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style("opacity",1)})).on("click",(function(a){calendarHeatmap.in_transition||(calendarHeatmap.in_transition=!0,calendarHeatmap.selected={date:a},calendarHeatmap.hideTooltip(),calendarHeatmap.removeGlobalOverview(),calendarHeatmap.overview="year",calendarHeatmap.drawChart())}))},drawYearOverview:function(){calendarHeatmap.history[calendarHeatmap.history.length-1]!==calendarHeatmap.overview&&calendarHeatmap.history.push(calendarHeatmap.overview);var a=moment(calendarHeatmap.selected.date).startOf("year"),e=moment(calendarHeatmap.selected.date).endOf("year"),t=calendarHeatmap.data.filter((function(t){return a<=moment(t.date)&&moment(t.date)<e})),n=calendarHeatmap.mergeMissingDates(a,e,t),r=d3.max(n,(function(a){return a.total})),l=d3.timeDays(moment().startOf("week"),moment().endOf("week")),i=d3.scaleBand().rangeRound([calendarHeatmap.settings.label_padding,calendarHeatmap.settings.height]).domain(l.map((function(a){return moment(a).weekday()}))),o=(d3.scaleLinear().range(["#ffffff",calendarHeatmap.color||"#ff4500"]).domain([-.15*r,r]),function(e,t){var n=moment(e.date),r=Math.round((n-moment(a).startOf("week"))/864e5);return Math.trunc(r/7)*(calendarHeatmap.settings.item_size+calendarHeatmap.settings.gutter)+calendarHeatmap.settings.label_padding}),d=function(a,e){return calendarHeatmap.settings.label_padding+moment(a.date).weekday()*(calendarHeatmap.settings.item_size+calendarHeatmap.settings.gutter)},s=function(a){return r<=0?calendarHeatmap.settings.item_size:.95*calendarHeatmap.settings.item_size};calendarHeatmap.items.selectAll(".item-block-month").remove(),calendarHeatmap.items.selectAll(".text").remove(),calendarHeatmap.items.selectAll(".item-rect").remove(),calendarHeatmap.items.selectAll(".item-rect").data(n).enter().append("rect").attr("class","item item-rect").style("opacity",0).attr("x",(function(a,e){return o(a)+(calendarHeatmap.settings.item_size-s())/2})).attr("y",(function(a,e){return d(a)+(calendarHeatmap.settings.item_size-s())/2})).attr("width",(function(a){return s()})).attr("height",(function(a){return s()})).attr("stroke",(function(a){return a.total>0?"#292929":"#ccc"})).attr("fill",(function(a){return a.total>0?calendarHeatmap.getColor(a.total,a):"#fff"})).on("click",(function(a){calendarHeatmap.in_transition||0!==a.total&&(calendarHeatmap.in_transition=!0,calendarHeatmap.selected=a,calendarHeatmap.hideTooltip(),calendarHeatmap.removeYearOverview(),calendarHeatmap.overview="day",calendarHeatmap.drawChart())})).on("mouseover",(function(a){if(!(calendarHeatmap.in_transition||a.total<=0)){var e=d3.select(this);!function a(){e=e.transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).attr("x",(function(a){return o(a)-(1.1*calendarHeatmap.settings.item_size-calendarHeatmap.settings.item_size)/2})).attr("y",(function(a,e){return d(a)-(1.1*calendarHeatmap.settings.item_size-calendarHeatmap.settings.item_size)/2})).attr("width",1.1*calendarHeatmap.settings.item_size).attr("height",1.1*calendarHeatmap.settings.item_size).transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).attr("x",(function(a){return o(a)+(calendarHeatmap.settings.item_size-s())/2})).attr("y",(function(a,e){return d(a)+(calendarHeatmap.settings.item_size-s())/2})).attr("width",(function(a){return s()})).attr("height",(function(a){return s()})).on("end",a)}();var t="";if(3==a.type)t+='<div class="header"><strong>'+a.strProjects+"</strong><div><br>",t+="<div>on "+moment(a.date).format("dddd, MMM Do YYYY")+"</div>";else{t+='<div class="header"><strong>'+(a.total?calendarHeatmap.formatTime(a.total):"No time")+" booked</strong></div>",t+="<div>on "+moment(a.date).format("dddd, MMM Do YYYY")+"</div><br>";for(var n=0;n<a.summary.length;n++)a&&a.strToolTip&&(t+="<div><span><strong>"+(a.strToolTip.match(/Sick/)||a.strToolTip.match(/Annual/)||a.strToolTip.match(/Public/)?a.strToolTip:"")+"</strong></span>"),t+="<div><span><strong>"+a.summary[n].name+"</strong></span>",t+="<span>"+calendarHeatmap.formatTime(a.summary[n].value)+"</span></div>"}var r=o(a)+calendarHeatmap.settings.item_size;calendarHeatmap.settings.width-r<calendarHeatmap.settings.tooltip_width+3*calendarHeatmap.settings.tooltip_padding&&(r-=calendarHeatmap.settings.tooltip_width+2*calendarHeatmap.settings.tooltip_padding);var l=Math.abs(document.getElementById(calendarHeatmap.container).getBoundingClientRect().top-document.getElementById(calendarHeatmap.container).getBoundingClientRect().height)+calendarHeatmap.settings.item_size;calendarHeatmap.tooltip.html(t).style("left",r+"px").style("top",l+"px").transition().duration(calendarHeatmap.settings.transition_duration/2).ease(d3.easeLinear).style("opacity",1)}})).on("mouseout",(function(){calendarHeatmap.in_transition||(d3.select(this).transition().duration(calendarHeatmap.settings.transition_duration/2).ease(d3.easeLinear).attr("x",(function(a){return o(a)+(calendarHeatmap.settings.item_size-s())/2})).attr("y",(function(a,e){return d(a)+(calendarHeatmap.settings.item_size-s())/2})).attr("width",(function(a){return s()})).attr("height",(function(a){return s()})),calendarHeatmap.hideTooltip())})).transition().delay((function(){return(Math.cos(Math.PI*Math.random())+1)*calendarHeatmap.settings.transition_duration})).duration((function(){return calendarHeatmap.settings.transition_duration})).ease(d3.easeLinear).style("opacity",1).call((function(a,e){a.empty()&&e();var t=0;a.each((function(){++t})).on("end",(function(){--t||e.apply(this,arguments)}))}),(function(){calendarHeatmap.in_transition=!1})),calendarHeatmap.labels.selectAll(".label-monthDate").remove(),calendarHeatmap.labels.selectAll(".label-dayDate").remove();calendarHeatmap.items.selectAll(".text").remove(),calendarHeatmap.items.selectAll(".text").data(n).enter().append("text").attr("class",(function(a){return calendarHeatmap.isCurrentMonth(a)?"text currMoment":"text"})).text((function(a,e){return moment(a.date).format("DD")})).style("opacity",1).style("fill",(function(a,e){return a.total>0?calendarHeatmap.getTextColor(a.total,a,""):"#bfbfbf"})).attr("text-anchor","middle").attr("y",(function(a,e){return 12.5+(d(a)+(calendarHeatmap.settings.item_size-s())/2)})).attr("x",(function(a,e){return 10+(o(a)+(calendarHeatmap.settings.item_size-s())/2)}));var m=d3.timeMonths(a,e),c=d3.scaleLinear().range([0,calendarHeatmap.settings.width]).domain([0,m.length]);calendarHeatmap.labels.selectAll(".label-month").remove(),calendarHeatmap.labels.selectAll(".label-month").data(m).enter().append("text").attr("class",(function(a){return calendarHeatmap.isCurrentMonth(a,"month")?"label label-month currMoment":"label label-month"})).attr("font-size",(function(a){return(calendarHeatmap.isCurrentMonth(a)?Math.floor(calendarHeatmap.settings.label_padding/3)+1:Math.floor(calendarHeatmap.settings.label_padding/3))+"px"})).text((function(a){return a.toLocaleDateString("en-us",{month:"short"})+","+moment(calendarHeatmap.selected.date).format("YYYY")})).attr("x",(function(a,e){return c(e)+(c(e)-c(e-1))/2})).attr("y",calendarHeatmap.settings.label_padding/2).on("mouseenter",(function(a){if(!calendarHeatmap.in_transition){var e=moment(a);calendarHeatmap.items.selectAll(".item-rect").transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style("opacity",(function(a){return moment(a.date).isSame(e,"month")?1:.1})),calendarHeatmap.items.selectAll(".text").transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style("opacity",(function(a){return moment(a.date).isSame(e,"month")?1:.1}))}})).on("mouseout",(function(){calendarHeatmap.in_transition||(calendarHeatmap.items.selectAll(".item-rect").transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style("opacity",1),calendarHeatmap.items.selectAll(".text").transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style("opacity",1))})).on("click",(function(a){calendarHeatmap.in_transition||calendarHeatmap.data.filter((function(e){return moment(a).startOf("month")<=moment(e.date)&&moment(e.date)<moment(a).endOf("month")})).length&&(calendarHeatmap.selected={date:a},calendarHeatmap.in_transition=!0,calendarHeatmap.hideTooltip(),calendarHeatmap.removeYearOverview(),calendarHeatmap.overview="month",calendarHeatmap.drawChart())}));l=d3.timeDays(moment().startOf("week"),moment().endOf("week")),i=d3.scaleBand().rangeRound([calendarHeatmap.settings.label_padding,calendarHeatmap.settings.height]).domain(l.map((function(a){return moment(a).weekday()})));calendarHeatmap.labels.selectAll(".label-day").remove(),calendarHeatmap.labels.selectAll(".label-day").data(l).enter().append("text").attr("class",(function(a){return calendarHeatmap.isCurrentMonth(a)?"label label-day currMoment":"label label-day"})).attr("x",calendarHeatmap.settings.label_padding/3).attr("y",(function(a,e){return i(e)+i.bandwidth()/1.75})).style("text-anchor","left").attr("font-size",(function(a){return(calendarHeatmap.isCurrentMonth(a)?Math.floor(calendarHeatmap.settings.label_padding/3)+1:Math.floor(calendarHeatmap.settings.label_padding/3))+"px"})).text((function(a){return moment(a).format("dddd")[0]+moment(a).format("dddd")[1]+moment(a).format("dddd")[2]})).on("mouseenter",(function(a){if(!calendarHeatmap.in_transition){var e=moment(a);calendarHeatmap.items.selectAll(".item-rect").transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style("opacity",(function(a){return moment(a.date).day()===e.day()?1:.1})),calendarHeatmap.items.selectAll(".text").transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style("opacity",(function(a){return moment(a.date).day()===e.day()?1:.1}))}})).on("mouseout",(function(){calendarHeatmap.in_transition||(calendarHeatmap.items.selectAll(".item-rect").transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style("opacity",1),calendarHeatmap.items.selectAll(".text").transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style("opacity",1))})),calendarHeatmap.drawButton()},drawMonthOverview:function(){calendarHeatmap.items.selectAll(".text").remove(),calendarHeatmap.history[calendarHeatmap.history.length-1]!==calendarHeatmap.overview&&calendarHeatmap.history.push(calendarHeatmap.overview);for(var a=moment(calendarHeatmap.selected.date).startOf("month"),e=moment(calendarHeatmap.selected.date).endOf("month"),t=calendarHeatmap.data.filter((function(t){return a<=moment(t.date)&&moment(t.date)<e})),n=calendarHeatmap.mergeMissingDates(a,e,t),r=d3.max(n,(function(a){return d3.max(a.summary,(function(a){return a.value}))})),l=d3.timeDays(moment().startOf("week"),moment().endOf("week")),i=d3.scaleBand().rangeRound([calendarHeatmap.settings.label_padding,calendarHeatmap.settings.height]).domain(l.map((function(a){return moment(a).weekday()}))),o=[a.clone()];a.week()!==e.week();)o.push(a.add(1,"week").clone());var d=d3.scaleBand().rangeRound([calendarHeatmap.settings.label_padding,calendarHeatmap.settings.width]).padding([.05]).domain(o.map((function(a){return a.week()})));calendarHeatmap.labels.selectAll(".label-monthDate").remove(),calendarHeatmap.labels.selectAll(".label-dayDate").remove(),calendarHeatmap.items.selectAll(".item-block-month").remove();var s=calendarHeatmap.items.selectAll(".item-block-month").data(n).enter().append("g").attr("class","item item-block-month").attr("width",(function(){return(calendarHeatmap.settings.width-calendarHeatmap.settings.label_padding)/o.length-5*calendarHeatmap.settings.gutter})).attr("height",(function(){return Math.max(i.bandwidth(),calendarHeatmap.settings.max_block_height)-calendarHeatmap.settings.label_padding})).attr("transform",(function(a){return"translate("+d(moment(a.date).week())+","+(i(moment(a.date).weekday())+i.bandwidth()/1.75-15)+")"})).attr("total",(function(a){return a.total})).attr("date",(function(a){return a.date})).attr("offset",0).attr("lblOffset",0).on("click",(function(a){calendarHeatmap.in_transition||0!==a.total&&(calendarHeatmap.in_transition=!0,calendarHeatmap.selected=a,calendarHeatmap.hideTooltip(),calendarHeatmap.removeMonthOverview(),calendarHeatmap.overview="day",calendarHeatmap.drawChart())})),m=(calendarHeatmap.settings.width-calendarHeatmap.settings.label_padding)/o.length-5*calendarHeatmap.settings.gutter,c=d3.scaleLinear().rangeRound([0,m]);s.selectAll(".item-block-rect").data((function(a){return a.summary})).enter().append("rect").attr("class","item item-block-rect").attr("x",(function(a){var e=parseInt(d3.select(this.parentNode).attr("total")),t=parseInt(d3.select(this.parentNode).attr("offset"));return c.domain([0,e]),d3.select(this.parentNode).attr("offset",t+c(a.value)),t})).attr("stroke",(function(a){return a.value>0?"#292929":"#ccc"})).attr("width",(function(a){var e=parseInt(d3.select(this.parentNode).attr("total"));return c.domain([0,e]),a.value<=0?d3.select(this.parentNode).attr("width"):Math.max(c(a.value)-calendarHeatmap.settings.item_gutter,1)})).attr("height",(function(){return Math.min(i.bandwidth(),calendarHeatmap.settings.max_block_height)+.75*calendarHeatmap.settings.item_gutter})).attr("fill",(function(a){var e=[calendarHeatmap.getColor(a.value,d3.select(this.parentNode).datum()),calendarHeatmap.getColor(a.value,d3.select(this.parentNode).datum())],t=d3.scaleLinear().range(e).domain([-.15*r,r]);return a.value>0?t(a.value)||"#ff4500":"#fff"})).style("opacity",0).on("mouseover",(function(a){if(!(calendarHeatmap.in_transition||a.value<=0)){var e=new Date(d3.select(this.parentNode).attr("date")),t=d3.select(this.parentNode).datum(),n=null;if(t)n=t.details.filter((function(e){return e.name==a.name}))[0];var r="";3==a.type?(r+='<div class="header"><strong>'+(t.strProjects?t.strProjects:a.name)+"</strong><div><br>",r+="<div>on "+moment(a.date).format("dddd, MMM Do YYYY")+"</div>"):(r+='<div class="header"><strong>'+(n?n.strProjects:t.strProjects?t.strProjects:a.name)+"</strong></div><br>",r+="<div><strong>"+(a.value?calendarHeatmap.formatTime(a.value):"No time")+" booked</strong></div>",r+="<div>on "+moment(e).format("dddd, MMM Do YYYY")+"</div>");for(var l=d(moment(e).week())+calendarHeatmap.settings.tooltip_padding;calendarHeatmap.settings.width-l<calendarHeatmap.settings.tooltip_width+3*calendarHeatmap.settings.tooltip_padding;)l-=10;var i=Math.abs(document.getElementById(calendarHeatmap.container).getBoundingClientRect().top-document.getElementById(calendarHeatmap.container).getBoundingClientRect().height)+calendarHeatmap.settings.tooltip_padding;calendarHeatmap.tooltip.html(r).style("left",l+"px").style("top",i+"px").transition().duration(calendarHeatmap.settings.transition_duration/2).ease(d3.easeLinear).style("opacity",1)}})).on("mouseout",(function(){calendarHeatmap.in_transition||calendarHeatmap.hideTooltip()})).transition().delay((function(){return(Math.cos(Math.PI*Math.random())+1)*calendarHeatmap.settings.transition_duration})).duration((function(){return calendarHeatmap.settings.transition_duration})).ease(d3.easeLinear).style("opacity",1).call((function(a,e){a.empty()&&e();var t=0;a.each((function(){++t})).on("end",(function(){--t||e.apply(this,arguments)}))}),(function(){calendarHeatmap.in_transition=!1}));s.selectAll(".text").remove(),s.selectAll(".text").data(["21/11"]).enter().append("text").attr("class","text").text((function(a,e){return moment(d3.select(this.parentNode).attr("date")).format("DD/MM")+" : "+(d3.select(this.parentNode).attr("total")?calendarHeatmap.formatTime(d3.select(this.parentNode).attr("total")):"No time")})).style("fill",(function(a,e){var t=calendarHeatmap.getTextColor(d3.select(this.parentNode).attr("total"),d3.select(this.parentNode).datum(),"");return d3.select(this.parentNode).attr("total")>0?t:"#bfbfbf"})).attr("text-anchor","left").attr("opacity","1").attr("y",(function(){return 15})).attr("x",(function(a){var e=parseInt(d3.select(this.parentNode).attr("total")),t=parseInt(d3.select(this.parentNode).attr("lblOffset"));return c.domain([0,e]),d3.select(this.parentNode).attr("lblOffset",t+c(a.value)),t+20})),calendarHeatmap.labels.selectAll(".label-week").remove(),calendarHeatmap.labels.selectAll(".label-week").data(o).enter().append("text").attr("class",(function(a){return moment(a).week()===calendarHeatmap.currDate.week()?"label label-week currMoment":"label label-week"})).attr("font-size",(function(a){return(moment(a).week()===calendarHeatmap.currDate.week()?Math.floor(calendarHeatmap.settings.label_padding/3)+1:Math.floor(calendarHeatmap.settings.label_padding/3))+"px"})).text((function(a){var e=moment().year(a.year()).week(a.week()).startOf("week").format("DD/MMM"),t=moment().year(a.year()).week(a.week()).endOf("week").format("DD/MMM");return"Week "+a.week()+" ("+e+" - "+t+")"})).attr("x",(function(a){return d(a.week())})).attr("y",calendarHeatmap.settings.label_padding/2).on("mouseenter",(function(a){calendarHeatmap.in_transition||calendarHeatmap.items.selectAll(".item-block-month").transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style("opacity",(function(e){return moment(e.date).week()===a.week()?1:.1}))})).on("mouseout",(function(){calendarHeatmap.in_transition||calendarHeatmap.items.selectAll(".item-block-month").transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style("opacity",1)})).on("click",(function(a){calendarHeatmap.in_transition||calendarHeatmap.data.filter((function(e){return a.startOf("week")<=moment(e.date)&&moment(e.date)<a.endOf("week")})).length&&(calendarHeatmap.in_transition=!0,calendarHeatmap.selected={date:a},calendarHeatmap.hideTooltip(),calendarHeatmap.removeMonthOverview(),calendarHeatmap.overview="week",calendarHeatmap.drawChart())})),calendarHeatmap.labels.selectAll(".label-day").remove(),calendarHeatmap.labels.selectAll(".label-day").data(l).enter().append("text").attr("class",(function(a){return moment(a).day()===calendarHeatmap.currDate.day()?"label label-day currMoment":"label label-day"})).attr("x",calendarHeatmap.settings.label_padding/3).attr("y",(function(a,e){return i(e)+i.bandwidth()/1.75})).style("text-anchor","left").attr("font-size",(function(a){return(moment(a).day()===calendarHeatmap.currDate.day()?Math.floor(calendarHeatmap.settings.label_padding/3)+1:Math.floor(calendarHeatmap.settings.label_padding/3))+"px"})).text((function(a){return moment(a).format("dddd")[0]+moment(a).format("dddd")[1]+moment(a).format("dddd")[2]})).on("mouseenter",(function(a){if(!calendarHeatmap.in_transition){var e=moment(a);calendarHeatmap.items.selectAll(".item-block-month").transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style("opacity",(function(a){return moment(a.date).day()===e.day()?1:.1}))}})).on("mouseout",(function(){calendarHeatmap.in_transition||calendarHeatmap.items.selectAll(".item-block-month").transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style("opacity",1)})),calendarHeatmap.drawButton()},drawWeekOverview:function(){calendarHeatmap.history[calendarHeatmap.history.length-1]!==calendarHeatmap.overview&&calendarHeatmap.history.push(calendarHeatmap.overview);var a=moment(calendarHeatmap.selected.date).startOf("week"),e=moment(calendarHeatmap.selected.date).endOf("week"),t=calendarHeatmap.data.filter((function(t){return a<=moment(t.date)&&moment(t.date)<e})),n=calendarHeatmap.mergeMissingDates(a,e,t),r=d3.max(n,(function(a){return d3.max(a.summary,(function(a){return a.value}))})),l=d3.timeDays(moment().startOf("week"),moment().endOf("week")),i=d3.scaleBand().rangeRound([calendarHeatmap.settings.label_padding,calendarHeatmap.settings.height]).domain(l.map((function(a){return moment(a).weekday()}))),o=[a],d=d3.scaleBand().rangeRound([calendarHeatmap.settings.label_padding,calendarHeatmap.settings.width]).padding([.01]).domain(o.map((function(a){return a.week()})));calendarHeatmap.items.selectAll(".text").remove(),calendarHeatmap.items.selectAll(".label-monthDate").remove(),calendarHeatmap.items.selectAll(".item-block-week").remove();var s=calendarHeatmap.items.selectAll(".item-block-week").data(n).enter().append("g").attr("class","item item-block-week").attr("width",(function(){return(calendarHeatmap.settings.width-calendarHeatmap.settings.label_padding)/o.length-5*calendarHeatmap.settings.gutter})).attr("height",(function(){return Math.min(i.bandwidth(),calendarHeatmap.settings.max_block_height)})).attr("transform",(function(a){return"translate("+d(moment(a.date).week())+","+(i(moment(a.date).weekday())+i.bandwidth()/1.75-15)+")"})).attr("total",(function(a){return a.total})).attr("date",(function(a){return a.date})).attr("offset",0).attr("lblOffset",0).on("click",(function(a){calendarHeatmap.in_transition||0!==a.total&&(calendarHeatmap.in_transition=!0,calendarHeatmap.selected=a,calendarHeatmap.hideTooltip(),calendarHeatmap.removeWeekOverview(),calendarHeatmap.overview="day",calendarHeatmap.drawChart())})),m=(calendarHeatmap.settings.width-calendarHeatmap.settings.label_padding)/o.length-5*calendarHeatmap.settings.gutter,c=d3.scaleLinear().rangeRound([0,m]);s.selectAll(".item-block-rect").data((function(a){return a.summary})).enter().append("rect").attr("class","item item-block-rect").attr("x",(function(a){var e=parseInt(d3.select(this.parentNode).attr("total")),t=parseInt(d3.select(this.parentNode).attr("offset"));return c.domain([0,e]),d3.select(this.parentNode).attr("offset",t+c(a.value)),t})).attr("width",(function(a){var e=parseInt(d3.select(this.parentNode).attr("total"));return c.domain([0,e]),a.value<=0?d3.select(this.parentNode).attr("width"):Math.max(c(a.value)-calendarHeatmap.settings.item_gutter,1)})).attr("stroke",(function(a){return d3.select(this.parentNode).attr("total")>0?"#292929":"#ccc"})).attr("height",(function(){return Math.min(i.bandwidth(),calendarHeatmap.settings.max_block_height)})).attr("fill",(function(a){var e=[calendarHeatmap.getColor(a.value,d3.select(this.parentNode).datum()),calendarHeatmap.getColor(a.value,d3.select(this.parentNode).datum())],t=d3.scaleLinear().range(e).domain([-.15*r,r]);return a.value>0?t(a.value)||"#ff4500":"#fff"})).style("opacity",0).on("mouseover",(function(a){if(!(calendarHeatmap.in_transition||a.value<=0)){var e=new Date(d3.select(this.parentNode).attr("date")),t="";3==a.type?(t+='<div class="header"><strong>'+d3.select(this.parentNode).datum().strProjects+"</strong><div><br>",t+="<div>on "+moment(a.date).format("dddd, MMM Do YYYY")+"</div>"):(t+='<div class="header"><strong>'+a.name+"</strong></div><br>",t+="<div><strong>"+(a.value?calendarHeatmap.formatTime(a.value):"No time")+" booked</strong></div>",t+="<div>on "+moment(e).format("dddd, MMM Do YYYY")+"</div>");var n=parseInt(d3.select(this.parentNode).attr("total"));c.domain([0,n]);for(var r=parseInt(d3.select(this).attr("x"))+c(a.value)/4+calendarHeatmap.settings.tooltip_width/4;calendarHeatmap.settings.width-r<calendarHeatmap.settings.tooltip_width+3*calendarHeatmap.settings.tooltip_padding;)r-=10;var l=Math.abs(document.getElementById(calendarHeatmap.container).getBoundingClientRect().top-document.getElementById(calendarHeatmap.container).getBoundingClientRect().height)+calendarHeatmap.settings.tooltip_padding;calendarHeatmap.tooltip.html(t).style("left",r+"px").style("top",l+"px").transition().duration(calendarHeatmap.settings.transition_duration/2).ease(d3.easeLinear).style("opacity",1)}})).on("mouseout",(function(){calendarHeatmap.in_transition||calendarHeatmap.hideTooltip()})).transition().delay((function(){return(Math.cos(Math.PI*Math.random())+1)*calendarHeatmap.settings.transition_duration})).duration((function(){return calendarHeatmap.settings.transition_duration})).ease(d3.easeLinear).style("opacity",1).call((function(a,e){a.empty()&&e();var t=0;a.each((function(){++t})).on("end",(function(){--t||e.apply(this,arguments)}))}),(function(){calendarHeatmap.in_transition=!1}));s.selectAll(".text").remove(),s.selectAll(".text").data(["21/11"]).enter().append("text").attr("class","text").text((function(a,e){var t=d3.select(this.parentNode).attr("total")&&d3.select(this.parentNode).attr("total")>0?calendarHeatmap.formatTime(d3.select(this.parentNode).attr("total"))+"    ;  ( "+d3.select(this.parentNode).datum().strProjects+" )":null;return moment(d3.select(this.parentNode).attr("date")).format("DD/MMM")+(t||" : - - ")})).style("fill",(function(a,e){var t=calendarHeatmap.getTextColor(d3.select(this.parentNode).attr("total"),d3.select(this.parentNode).datum(),"");return d3.select(this.parentNode).attr("total")>0?t:"#bfbfbf"})).attr("text-anchor","left").attr("opacity","1").attr("y",(function(){return 15})).attr("x",(function(a){var e=parseInt(d3.select(this.parentNode).attr("total")),t=parseInt(d3.select(this.parentNode).attr("lblOffset"));return c.domain([0,e]),d3.select(this.parentNode).attr("lblOffset",t+c(a.value)),t+30})),calendarHeatmap.labels.selectAll(".label-week").remove(),calendarHeatmap.labels.selectAll(".label-week").data(o).enter().append("text").attr("class","label label-week").attr("font-size",(function(){return Math.floor(calendarHeatmap.settings.label_padding/3)+"px"})).text((function(a){var e=moment().year(a.year()).week(a.week()).startOf("week").format("DD/MMM"),t=moment().year(a.year()).week(a.week()).endOf("week").format("DD/MMM");return"Week "+a.week()+" ("+e+" - "+t+")"})).attr("x",(function(a){return d(a.week())+100})).attr("y",calendarHeatmap.settings.label_padding/2).on("mouseenter",(function(a){calendarHeatmap.in_transition||calendarHeatmap.items.selectAll(".item-block-week").transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style("opacity",(function(e){return moment(e.date).week()===a.week()?1:.1}))})).on("mouseout",(function(){calendarHeatmap.in_transition||calendarHeatmap.items.selectAll(".item-block-week").transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style("opacity",1)})),calendarHeatmap.labels.selectAll(".label-monthDate").remove(),calendarHeatmap.labels.selectAll(".label-day").remove(),calendarHeatmap.labels.selectAll(".label-day").data(l).enter().append("text").attr("class","label label-day").attr("x",calendarHeatmap.settings.label_padding/3).attr("y",(function(a,e){return i(e)+i.bandwidth()/1.75})).style("text-anchor","left").attr("font-size",(function(){return Math.floor(calendarHeatmap.settings.label_padding/3)+"px"})).text((function(a){return moment(a).format("dddd")[0]+moment(a).format("dddd")[1]+moment(a).format("dddd")[2]})).on("mouseenter",(function(a){if(!calendarHeatmap.in_transition){var e=moment(a);calendarHeatmap.items.selectAll(".item-block-week").transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style("opacity",(function(a){return moment(a.date).day()===e.day()?1:.1}))}})).on("mouseout",(function(){calendarHeatmap.in_transition||calendarHeatmap.items.selectAll(".item-block-week").transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style("opacity",1)})),calendarHeatmap.drawButton()},drawDayOverview:function(){var a=0;calendarHeatmap.history[calendarHeatmap.history.length-1]!==calendarHeatmap.overview&&calendarHeatmap.history.push(calendarHeatmap.overview),Object.keys(calendarHeatmap.selected).length||(calendarHeatmap.selected=calendarHeatmap.data[calendarHeatmap.data.length-1]);var e=calendarHeatmap.selected.summary.sort((function(a,e){return e.type<a.type})).map((function(a){return a.name})),t=d3.scaleBand().rangeRound([calendarHeatmap.settings.label_padding,calendarHeatmap.settings.height]).domain(e),n=d3.scaleTime().range([2*calendarHeatmap.settings.label_padding,calendarHeatmap.settings.width]).domain([moment(calendarHeatmap.selected.date).startOf("day"),moment(calendarHeatmap.selected.date).endOf("day")]);calendarHeatmap.items.selectAll(".text").remove(),calendarHeatmap.items.selectAll(".label-monthDate").remove(),calendarHeatmap.items.selectAll(".item-block-day").remove(),calendarHeatmap.items.selectAll(".item-block").remove();var r=calendarHeatmap.items.selectAll(".item-block").data(calendarHeatmap.selected.details).enter().append("g").attr("class","item item-block").attr("width",(function(a){var e=n(d3.timeSecond.offset(moment(a.date),a.value));return Math.max(e-n(moment(a.date)),1)})).attr("height",(function(){return Math.min(t.bandwidth(),calendarHeatmap.settings.max_block_height)})).attr("total",(function(a){return a.total})).attr("date",(function(a){return a.date})).attr("offset",0).attr("lblOffset",0);calendarHeatmap.items.selectAll(".text").remove(),calendarHeatmap.items.selectAll(".item-block-day").remove(),r.selectAll(".item-block").data(calendarHeatmap.selected.details).enter().append("rect").attr("class","item item-block-day").attr("x",(function(a){return n(moment(a.date))})).attr("y",(function(a){return t(a.name)+t.bandwidth()/2-15})).attr("width",(function(a){var e=n(d3.timeSecond.offset(moment(a.date),a.value));return Math.max(e-n(moment(a.date)),1)})).attr("height",(function(){return Math.min(t.bandwidth(),calendarHeatmap.settings.max_block_height)})).attr("stroke",(function(a){return a.value>0?"#292929":"#ccc"})).attr("fill",(function(a){return calendarHeatmap.getColor(a.value,a)})).style("opacity",0).on("mouseover",(function(a){if(!(calendarHeatmap.in_transition||a.value<=0)){var e="";3==a.type?(e+='<div class="header"><strong>'+a.strProjects+"</strong><div><br>",e+="<div>on "+moment(a.date).format("dddd, MMM Do YYYY")+"</div>"):(e+='<div class="header"><strong>'+a.strProjects+"</strong><div><br>",e+="<div><strong>"+(a.value?calendarHeatmap.formatTime(a.value):"No time")+" booked</strong></div>",e+="<div>on "+moment(a.date).format("dddd, MMM Do YYYY")+"</div>");for(var t=100*a.value/86400+n(moment(a.date));calendarHeatmap.settings.width-t<calendarHeatmap.settings.tooltip_width+3*calendarHeatmap.settings.tooltip_padding;)t-=10;var r=Math.abs(document.getElementById(calendarHeatmap.container).getBoundingClientRect().top-document.getElementById(calendarHeatmap.container).getBoundingClientRect().height)+calendarHeatmap.settings.tooltip_padding;calendarHeatmap.tooltip.html(e).style("left",t+"px").style("top",r+"px").transition().duration(calendarHeatmap.settings.transition_duration/2).ease(d3.easeLinear).style("opacity",1)}})).on("mouseout",(function(a){calendarHeatmap.in_transition||a.value<=0||calendarHeatmap.hideTooltip()})).on("click",(function(a){calendarHeatmap.handler&&"function"==typeof calendarHeatmap.handler&&calendarHeatmap.handler(a)})).transition().delay((function(){return(Math.cos(Math.PI*Math.random())+1)*calendarHeatmap.settings.transition_duration})).duration((function(){return calendarHeatmap.settings.transition_duration})).ease(d3.easeLinear).style("opacity",1).call((function(a,e){a.empty()&&e();var t=0;a.each((function(){++t})).on("end",(function(){--t||e.apply(this,arguments)}))}),(function(){calendarHeatmap.in_transition=!1})),calendarHeatmap.items.selectAll(".text").remove(),calendarHeatmap.items.selectAll(".text").data(calendarHeatmap.selected.details).enter().append("text").attr("class","text").text((function(a,e){var t=a.strProjects.replaceAll(a.name,"");return t=t.replaceAll("|",""),a.value?calendarHeatmap.formatTime(a.value):"No time"})).style("fill",(function(a,e){return calendarHeatmap.getTotalHours(a.value)>8?"#fff":"inherit"})).attr("text-anchor","left").attr("opacity","1").attr("x",(function(a){return n(moment(a.date))+5})).attr("y",(function(a){return t(a.name)+t.bandwidth()/2-5}));var l=d3.timeHours(moment(calendarHeatmap.selected.date).startOf("day"),moment(calendarHeatmap.selected.date).endOf("day")),i=d3.scaleTime().range([2*calendarHeatmap.settings.label_padding,calendarHeatmap.settings.width+20]).domain([0,l.length]);calendarHeatmap.labels.selectAll(".label-time").remove(),calendarHeatmap.labels.selectAll(".label-time").data(l).enter().append("text").attr("class","label label-time").attr("font-size",(function(){return Math.floor(calendarHeatmap.settings.label_padding/3)+"px"})).text((function(a,e){return 0==e?moment(a).format("DD/MMM"):moment(a).format("HH:mm")})).attr("x",(function(a,e){return i(e)-7})).attr("y",calendarHeatmap.settings.label_padding/2).on("mouseenter",(function(a){if(!calendarHeatmap.in_transition){var e=n(moment(a));calendarHeatmap.items.selectAll(".item-block").transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style("opacity",(function(a){var t=n(moment(a.date)),r=n(moment(a.date).add(a.value,"seconds"));return e>=t&&e<=r?1:.1}))}})).on("mouseout",(function(){calendarHeatmap.in_transition||calendarHeatmap.items.selectAll(".item-block").transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style("opacity",1)})),calendarHeatmap.labels.selectAll(".label-project").remove(),calendarHeatmap.labels.selectAll(".label-project").data(e).enter().append("text").attr("class","label label-project").attr("x",calendarHeatmap.settings.gutter).attr("y",(function(e){return a=a+t(e)+t.bandwidth()/2,t(e)+t.bandwidth()/2})).attr("min-height",(function(){return t.bandwidth()})).style("text-anchor","left").attr("font-size",(function(){return Math.floor(calendarHeatmap.settings.label_padding/3)+"px"})).text((function(a){return a})).each((function(){var a=d3.select(this);a.node().getComputedTextLength(),a.text()})).on("mouseenter",(function(a){calendarHeatmap.in_transition||calendarHeatmap.items.selectAll(".item-block").transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style("opacity",(function(e){return e.name===a?1:.1}))})).on("mouseout",(function(){calendarHeatmap.in_transition||calendarHeatmap.items.selectAll(".item-block").transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style("opacity",1)})),calendarHeatmap.drawButton()},drawButton:function(){calendarHeatmap.buttons.selectAll(".button").remove();var a=calendarHeatmap.buttons.append("g").attr("class","button button-back").style("opacity",0).on("click",(function(){calendarHeatmap.in_transition||(calendarHeatmap.in_transition=!0,"year"===calendarHeatmap.overview?calendarHeatmap.removeYearOverview():"month"===calendarHeatmap.overview?calendarHeatmap.removeMonthOverview():"week"===calendarHeatmap.overview?calendarHeatmap.removeWeekOverview():"day"===calendarHeatmap.overview&&calendarHeatmap.removeDayOverview(),calendarHeatmap.history.pop(),calendarHeatmap.overview=calendarHeatmap.history.pop(),calendarHeatmap.drawChart())}));a.append("circle").attr("cx",calendarHeatmap.settings.label_padding/2.25).attr("cy",calendarHeatmap.settings.label_padding/2.5).attr("r",calendarHeatmap.settings.item_size/2),a.append("text").attr("x",calendarHeatmap.settings.label_padding/2.25).attr("y",calendarHeatmap.settings.label_padding/2.5).attr("dy",(function(){return Math.floor(calendarHeatmap.settings.width/100)/3})).attr("font-size",(function(){return Math.floor(calendarHeatmap.settings.label_padding/3)+"px"})).html("&#x2190;"),a.transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style("opacity",1)},removeGlobalOverview:function(){calendarHeatmap.items.selectAll(".item-block-year").transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style("opacity",0).remove(),calendarHeatmap.labels.selectAll(".label-year").remove()},removeYearOverview:function(){calendarHeatmap.items.selectAll(".item-rect").transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style("opacity",0).remove(),calendarHeatmap.labels.selectAll(".label-day").remove(),calendarHeatmap.labels.selectAll(".label-month").remove(),calendarHeatmap.hideBackButton()},removeMonthOverview:function(){calendarHeatmap.items.selectAll(".item-block-month").selectAll(".item-block-rect").transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style("opacity",0).attr("x",(function(a,e){return e%2==0?-calendarHeatmap.settings.width/3:calendarHeatmap.settings.width/3})).remove(),calendarHeatmap.labels.selectAll(".label-day").remove(),calendarHeatmap.labels.selectAll(".label-week").remove(),calendarHeatmap.hideBackButton()},removeWeekOverview:function(){calendarHeatmap.items.selectAll(".item-block-week").selectAll(".item-block-rect").transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style("opacity",0).attr("x",(function(a,e){return e%2==0?-calendarHeatmap.settings.width/3:calendarHeatmap.settings.width/3})).remove(),calendarHeatmap.labels.selectAll(".label-day").remove(),calendarHeatmap.labels.selectAll(".label-week").remove(),calendarHeatmap.hideBackButton()},removeDayOverview:function(){calendarHeatmap.items.selectAll(".item-block").transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style("opacity",0).attr("x",(function(a,e){return e%2==0?-calendarHeatmap.settings.width/3:calendarHeatmap.settings.width/3})).remove(),calendarHeatmap.labels.selectAll(".label-time").remove(),calendarHeatmap.labels.selectAll(".label-project").remove(),calendarHeatmap.hideBackButton()},hideTooltip:function(){calendarHeatmap.tooltip.transition().duration(calendarHeatmap.settings.transition_duration/2).ease(d3.easeLinear).style("opacity",0)},hideBackButton:function(){calendarHeatmap.buttons.selectAll(".button").transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style("opacity",0).remove()},formatTime:function(a){var e=Math.floor(a/3600),t=Math.floor((a-3600*e)/60),n="";return e>0&&(n+=1===e?"1 hr ":e+" hrs "),t>0&&(n+=1===t?"1 min":t+" mins"),0===e&&0===t&&(n=" - - "),n},getColor:function(a,e,t){e&&(a=e.total?e.total:e.value);var n=Math.floor(a/3600),r=(Math.floor((a-3600*n)/60),"#faf8f2");if(t?(r=t.match(/Sick/)?calendarHeatmap.objColorConfig.sick:r,r=t.match(/Annual/)?calendarHeatmap.objColorConfig.annual:r,r=t.match(/Public/)?calendarHeatmap.objColorConfig.pbh:r):n<8?r=calendarHeatmap.objColorConfig.lesshrs:8==n?r=calendarHeatmap.objColorConfig.equalhrs:n>8&&(r=calendarHeatmap.objColorConfig.overhrs),e&&(e.strToolTip||e.strProjects)){var l=e.strProjects?e.strProjects:e.strToolTip;r=l.match(/Sick/)?calendarHeatmap.objColorConfig.sick:r,r=l.match(/Annual/)?calendarHeatmap.objColorConfig.annual:r,r=l.match(/Public/)?calendarHeatmap.objColorConfig.pbh:r}return r},getTextColor(a,e,t){e&&(a=e.total?e.total:e.value);var n=Math.floor(a/3600),r=(Math.floor((a-3600*n)/60),"#fff");return t?(r=t&&t.match(/Sick/)?"inherit":r,r=t&&t.match(/Annual/)?"inherit":r,r=t&&t.match(/Public/)?"inherit":r):r=Math.floor(a/3600)>8?"#fff":"inherit",e&&e.type&&(r=[1,2,3].includes(e.type)?"inherit":r),r},getTotalHours:a=>Math.floor(a/3600),isCurrentMonth:function(a,e){var t=!1;return t=moment(a).date()==calendarHeatmap.currDate.date()&&moment(a).month()==calendarHeatmap.currDate.month()&&moment(a).year()==calendarHeatmap.currDate.year(),e&&"month"==e&&(t=moment(a).month()==calendarHeatmap.currDate.month()&&moment(a).year()==calendarHeatmap.currDate.year()),t},mergeMissingDates:function(a,e,t){var n=[],r=d3.timeDays(a,e);const l=d3.timeFormat("%Y-%m-%dT00:00:00");return r.forEach((function(a,e){var r=t.filter((function(e){return e.date==l(a)}));r&&r.length?n.push(r[0]):n.push({date:l(a),details:[],total:0,strProjects:"",strToolTip:"",type:4,summary:[{name:"No booking",type:4,value:0}]})})),n.sort((function(a,e){return moment(a.date)-moment(e.date)})),n}};